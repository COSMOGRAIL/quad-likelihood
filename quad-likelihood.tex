\documentclass[11pt]{scrartcl}
\usepackage{amsmath}
\usepackage{xspace}
\usepackage{color}
 
\newcommand{\com}[2]{\xspace\textcolor{red}{\textbf{Comment by #1: #2}}}


\newcommand{\dt}[1]{\ensuremath{\Delta t_{\mathrm{#1}}}\xspace}
%\newcommand{\truedt}{\ensuremath{\Delta t_{\mathrm{true}}}\xspace}
%\newcommand{\modeldt}{\ensuremath{\Delta t_{\mathrm{model}}}\xspace}
%\newcommand{\obsdt}{\ensuremath{\Delta t_{\mathrm{obs}}}\xspace}


\begin{document}

\title{Paragraph on how to express the likelihood of a model given COSMOGRAIL time-delay measurements for quad lenses}
\date{\today}
\maketitle


\section{The current state}

The current way of expressing COSMOGRAIL results for quads is to give 6 dependent -- and consistent -- time-delay estimations, without any estimates of the covariances between these 6 measurements\footnote{We only check visually that the correlations between residuals behave as expected.}. This is described in Section 3 of the PyCS paper. The motivation for giving 6 measurements is that we don't want to pick a priori one of the QSO-images as reference. Note that delivering these 6 \emph{dependent} estimates does contain part of the information that would otherwise go into a covariance matrix associated with giving only 3 ``independent'' delays such as AB, AC and AD. Indeed, a tight covariance between AB and AC (for example) would tell that the delay BC is well constrained. Currently, we just give this delay BC. When fitting a lens model, one currently selects a posteriori 3 ``independent'' delays with small error bars, and one would pick this BC. That's how it was done so far.

\section{The problem}

\begin{itemize}
\item Assuming that these 3 ``independent'' point and uncertainty estimates are truly independent is wrong (the true delays are, but not their measurements). 
\item Selecting the 3 delays among 6 is arbitrary
\item Using all 6 of them without taking into account their covariances is certainly wrong
\end{itemize}

And so it's not fully clear how to write a likelihood of lens model predictions, given COSMOGRAIL measurements.

\section{The fix (under construction)}

We want to propose (and give in our publications) a classical form of the likelihood to be used when modeling our measurements. If we assume that all errors are Gaussian, this would be

\begin{equation}
p(\dt{model} | \mathrm{obs}) = \frac{1}{(2 \pi)^{n/2} |\Sigma|^{1/2}}\exp\left( -\frac{1}{2} (\dt{model}-\dt{obs})^T\Sigma^{-1}(\dt{model}-\dt{obs}) \right)
\end{equation}

where $\Sigma \approx \textrm{Cov}(\dt{obs})$ is an estimation of the covariance that we would give.

\begin{itemize}
\item We \emph{think} that writing this using 3 delays such as (AB, AC, 
AD) is correct, and the associated 3x3 covariance matrix does in fact 
capture the full information contained in our measurements, \emph{even 
if the light curve of A is of poor quality and the choice of BA, BC, BD 
seems apparently ``better''}. The choice of A as a reference does not 
matter, as long as the 3x3 covariance matrix is given together with the 
3 delay estimates. Test this ? \com{VB}{This is indeed completely True, 
when using a covariance matrix of AB, AC and BC with each shifts (A, B, 
C) randomly picked} (don't say "randomly picked", more details would be needed to understand the test and what was tested). \com{VB}{It varies a bit when considering the sub-matrix AB, 
AC, BC created with the PyCS procedure.}


\item For 6 delays, the covariance matrix would be 6x6. But this matrix 
is clearly redundant (BC = AC - AB exactly, for every single 
measurement). A real covariance matrix would be singular in this case, but our PyCS-way of computing it might avoid this. Still, our feeling is that 
using it in the above equation is wrong and would result in an overly 
tight likelihood.\com{VB}{Indeed, we can't use the above equation, 
because it {\textbf won't} work with a matrix whose determinant is 
zero. And it can be proven that determinant=0 if the rows or columns are 
not independent ! It however works in our case because of our tricky way 
to compute the variance using the worst of each bins, but I would tend 
to see this more as a glitch.}


If we want to use the 6x6 matrix nevertheless (because of our special 
conservative PyCS way of computing variances ignoring the true delays), 
can we modify the above equation to compensate for using redundant 
information ? \com{VB}{I would tend to say that we should not use the 
6x6 matrix, since if it was constructed in a robust, mathematical way 
then its full use would be forbidden by the math themselves. We should 
instead provide the four 3x3 sub-matrices and say that we recommend 
either to pick a reference image, or (better!) to run the analysis with 
the four images as reference turn in turn and take the average.}
Yes, I kind of agree.

\end{itemize}
\newpage
\subsection{question for Stackexchange}

Let's say I measure two values A and B $N$ times
(say $N=1000$), and I build the value C as a function of A and B, 
say C=A+B.\\ \com{mt}{mention noise, speak about random variables}
\\
From my $N$ measurements, I build a vector 
with their mean value $M_{obs}=(A_{obs}, B_{obs}, C_{obs})$ and a 
covariance matrix:

\begin{equation*}
\Sigma=
  \begin{pmatrix}
    cov(AA) & cov(AB) & cov(AC) \\
    cov(AB) & cov(BB) & cov(BC) \\
    cov(AC) & cov(BC) & cov(CC) \\      
  \end{pmatrix}
\end{equation*}
\\
\\
Now, let's say I want to use that covariance matrix to compute a 
probability distribution for a model of the values of A, B and C, that 
I call $M_{model} = (A_{model}, B_{model}, C_{model})$

\begin{equation*}
p(M_{model} |M_{obs}) = \frac{1}{(2 \pi)^{3/2} 
|\Sigma|^{1/2}}\exp\left( -\frac{1}{2} 
(M_{model}-M_{obs})^T\Sigma^{-1}(M_{model}-M_{obs}) \right)
\end{equation*}
\\
\\
However, since C = A+B, the covariance matrix will have a null 
determinant and cannot be inverted. Thus, I cannot compute probabilities 
using the equation above.\\ 
\\
If I am interested only in the probability distribution of $A_{model}$ 
over the range [$A_{obs}-X$, $A_{obs}+X$]\com{mt}{I don't get this}, fixing $B_{model} = B_{obs}$ 
and $C_{model} = C_{obs}$, I can build from my observations the two 
subsets $M_{ABobs}=(A_{obs}, B_{obs})$ and $M_{ACobs} = (A_{obs}, 
C_{obs})$, as well as the associated covariance matrices
\begin{equation*}
\Sigma_{AB}=
  \begin{pmatrix}
    cov(AA) & cov(AB) \\
    cov(AB) & cov(BB) \\     
  \end{pmatrix}
,\ \Sigma_{AC}=
  \begin{pmatrix}
    cov(AA) & cov(AC) \\
    cov(AC) & cov(CC) \\   
  \end{pmatrix}  
\end{equation*}
\\
\\
No surprises, if I plug theses in the equations above, I find the 
same result, i.e.\\ $p((A_{model}, B_{model}=B_{obs})|M_{ABobs}) = 
p((A_{model}, C_{model}=C_{obs})|M_{ACobs})  \ \forall \ A_{model} $ \\
\\
And here come the questions:
\begin{enumerate}
 \item Knowing that C=A+B, is it possible to use a modified version of 
$\Sigma$ to get the correct probability distribution without using 
subsets?
 \item Same question, but without knowing the exact function that links 
C to A and B (i.e assuming C can also be directly measured, but due to 
unknown measurement errors it is not exactly A+B)?
 
\end{enumerate}



\end{document}

